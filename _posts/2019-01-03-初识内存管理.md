---
published: true
tags:
  - 操作系统
  - 内存管理
author: persuez
---
> 每个程序员都梦想拥有这样的存储器：它是私有的、容量无限大的、速度无限快的，并且是永久性的（即断电时不会丢失数据。--《现代操作系统》

但是梦想是美好的，现实就是挺现实的。除此之外，经过多年的探索，人们提出了**分层存储器体系**的概念，在这个体系中，计算机有若干兆（MB）快速、昂贵且易失性的高速缓存，数千兆（GB）速度与价格适中且同样易失性的内存，以及几兆兆（TB）低速、廉价、非易失性的磁盘存储，另外有诸如 DVD 和 USB 等可移动存储装置。操作系统的一个工作就是将这个存储体系**抽象**为一个有用的模型并管理这个抽象模型。

操作系统中管理分层存储体系的部分称为**存储管理器**。它的任务是有效地管理内存，即记录哪些内存是正在使用，哪些内存是空闲的；在进程需要时为其分配内存，在进程使用完成后释放内存。

由于最底层的高速缓存的管理由硬件来完成（计算机体系结构中有学），这里先集中学习针对编程人员的内存模型，以及怎样优化管理内存。至于硬盘的抽象与管理，以后再学。

## 无存储器抽象
最简单的存储器抽象是没有抽象。早期的计算机都没有存储器抽象。也就是说，每一个程序都直接访问物理内存。当一个程序执行指令：
```MOV REGISTER1, 1000```时，计算机会将位置为 1000 的物理地址的内容移到 REGISTER1 中。因此，那时呈现给程序员的存储器模型就是简单的物理内存：从 0 到某个上限的地址集合，每一个地址对应一个可容纳一定数目二进制位的存储单元，通常是 8 个。

在这种直接面向物理内存的情况下，要想在内存中同时运行两个程序几乎是不可能的。如果一个程序在某个地址写入内容，另一个程序也在相同的地址写入一些内容，那将会覆盖掉第一个程序所写入的内容。

不过还是有一些可行选项的：
- 通过多线程编程实现并发。因为在引入线程时就假设一个进程中的所有线程对同一内存映像是可见的，那么实现并发也就不成问题了。但是这个想法并没有被广泛使用，因为人们通常希望能够在同一时间运行没有关联的程序，而这正是线程抽象不具备的能力。更进一步地，一个没有存储器抽象的系统也不大可能具有线程抽象的功能。
- 通过交换“同时”运行多个程序。操作系统只要把当前内存中的内容保存到磁盘文件中（可能还有寄存器内容），然后再把下一个程序读入到内存中运行即可。只要在某一个时间内存中只有一个程序，那么就不会发生冲突了。
